Import('targetEnv')
Import('hostEnv')
Import('networkDevice')

import os.path

SOURCES_NETUSBEE = Glob('uip/netusbee/*.c')
SOURCES_SVETHLANA = Glob('uip/svethlana/*.c')

SOURCES_DEVICE_DRIVER=[];

if((networkDevice == 'netusbee') or (networkDevice == 'ethernec')):
    SOURCES_DEVICE_DRIVER = SOURCES_NETUSBEE
elif((networkDevice == 'svethlana') or (networkDevice == 'supervidel')):
    SOURCES_DEVICE_DRIVER = SOURCES_SVETHLANA
else:
    print("Unknown network device set. Valid options are: 'netusbee' or 'svethlana'. Exiting...")
    SOURCES_DEVICE_DRIVER = ['']
    exit(0)

SOURCES = [
        "main.c",
        "uip_arch.c",
        "clock-arch.c",
        "ioredirect.c",
        targetEnv.Vasm('ioredirect-trap.s'),
        Glob('uip/*.c'),
        SOURCES_DEVICE_DRIVER,        
        targetEnv.SConscript("atari_http_server/SConscript", exports=['hostEnv', 'targetEnv'])
    ]

targetEnv.Append( CPPPATH=[ Dir('./uip').srcnode().abspath ] )
targetEnv.Append( CPPPATH=[ Dir('./').srcnode().abspath ] )

TARGETS =[
    targetEnv.Program("uip.tos", source = SOURCES),
    targetEnv.Program("romtest.tos", "romport-speed.c"),
    targetEnv.Program("contest.tos", "console-helper.c")
]

Return (["TARGETS"])