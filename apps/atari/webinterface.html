<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"> 
<meta name="description" content="uIPtool web interface">
<meta name="keywords" content="HTML,CSS,XML,JavaScript">
<meta name="author" content="Mystic Bytes">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="human">

<title id='Description'>uIPtool</title>
 
#include "icon.inc"

    <script type="text/javascript">

        var driveDummyData = [];         
        var directoryDummyData = []; 
        var fileDummyData = []; 

        function initSampleData(){
            // sample drive data

            driveDummyData.push({ name: 'A', type: 'd' });
            driveDummyData.push({ name: 'B', type: 'd' });
            driveDummyData.push({ name: 'C', type: 'd' });
            driveDummyData.push({ name: 'D', type: 'd' });
            driveDummyData.push({ name: 'E', type: 'd' });
            driveDummyData.push({ name: 'F', type: 'd' });
            driveDummyData.push({ name: 'G', type: 'd' });
            driveDummyData.push({ name: 'H', type: 'd' });
            driveDummyData.push({ name: 'I', type: 'd' });
            driveDummyData.push({ name: 'J', type: 'd' });
            driveDummyData.push({ name: 'K', type: 'd' });
            driveDummyData.push({ name: 'L', type: 'd' });
            driveDummyData.push({ name: 'M', type: 'd' });
            driveDummyData.push({ name: 'N', type: 'd' });
            driveDummyData.push({ name: 'O', type: 'd' });
            driveDummyData.push({ name: 'P', type: 'd' });

            // sample current dir data
            directoryDummyData.push({ name: 'root', type: 'd' });
            directoryDummyData.push({ name: 'AUTO', type: 'd' });
            directoryDummyData.push({ name: 'NVDI', type: 'd' });
            directoryDummyData.push({ name: 'CPX', type: 'd' });
            directoryDummyData.push({ name: 'CPX', type: 'd' });

            // sample file data
            fileDummyData.push({ name: 'DESKTOP.INF', type: 'f', date: 'f', size:12234 });
            fileDummyData.push({ name: 'ZENON.ACC', type: 'f', date: 'f', size:3434 });
            fileDummyData.push({ name: 'DEMO.TOS', type: 'f', date: 'f', size:32000 });
            fileDummyData.push({ name: 'PIC.NeO', type: 'f', date: 'f', size:32000 });
            fileDummyData.push({ name: 'README.TXT', type: 'f', date: 'f', size:1312322 });
        }

        function requestChangeCurrentDirectory(btn){
            alert(btn.name);
        }


        function createDriveButtons(rootElement, DriveArray){
          var buttonStr = null;
          
          for(var i=0;i<DriveArray.length;++i){

             buttonStr = DriveArray[i].name.toUpperCase();
             var button = document.createElement("button");
             var textNode = document.createTextNode(buttonStr + ':');
             button.appendChild(textNode);
             button.type='button';
             button.name = 'SetCurrentDir' + buttonStr;
             
             button.onclick = function(){
                requestChangeCurrentDirectory(this);            
             }

             rootElement.appendChild(button);
          };

        }

        function updateDriveViewUI(DriveArray){

          var div = document.createElement("div");
          div.style.width = "100%";
          div.style.height = "100px";
          div.style.background = "black";
          div.style.color = "white";
          div.innerHTML = 'Drives: ';

          createDriveButtons(div, DriveArray);            

          document.getElementById("DriveButtonListTab").appendChild(div);
        }


        function createDirectoryEntries(rootElement, DirectoryArray){


        }

        function updateDirectoryViewUI(DirJsonArray){
        
          var div = document.createElement("div");
          div.style.width = "20%";
          div.style.height = "80%";
          div.style.background = "black";
          div.style.color = "white";
          div.innerHTML = 'Directories: ';

          createDirectoryEntries(div,DirJsonArray);

          document.getElementById("directoryListView").appendChild(div);

        }


        function createFileEntries(rootElement, DirectoryArray){


        }


        function updateFileViewUI(FileJsonArray){
            var div = document.createElement("div");
          div.style.width = "80%";
          div.style.height = "80%";
          div.style.background = "black";
          div.style.color = "white";
          div.innerHTML = 'File list: ';

          createFileEntries(div, FileJsonArray)
          
          document.getElementById("directoryView").appendChild(div);        
        }


        function processDriveListReq(FileJsonArray) {
          var DriveArray = JSON.parse(responseText);
          updateDriveViewUI(DriveArray);  
        }

        


        // send http request 
        function sendHttpReq(addr, params, requestType, isAsync, requestHandler){

            var xhr = new XMLHttpRequest();
            
            if(isAsync!=true){
                xhr.open(requestType, 'http://' + addr +'/?' + params, isAsync);

                xhr.send();
                return xhr.responseText; 
            }else{
                xhr.onreadystatechange = function() { 
                    if (xhr.readyState == 4 && xhr.status == 200)
                       requestHandler(xhr.responseText);
                    }

                xhr.open(requestType, 'http://' + addr +'/?' + params, isAsync);
                xhr.send();
            }

            return null;
        }

        function updateDriveListReq(){
            var driveListJsonResult = sendHttpReq(location.host,'dir', 'GET', true, processDriveListReq);
            
        }


// This returns at least 32bit int with date encoded for DOSTIME struct
// typedef struct
// {
//      uint16_t     time;  /* Time like Tgettime */
//      uint16_t     date;  /* Date like Tgetdate */
// } DOSTIME;
     function convertDateToAtariTOSFormat(date) {
        var tosYear = (date.getFullYear() - 1980);
        tosYear = tosYear < 0 ? 0 : tosYear;
        tosYear = tosYear > 119 ? 119 : tosYear;
        var tosDay = date.getDate();
        var tosMonth = date.getMonth() + 1;
        var tosDate = (tosYear) << 9 | (tosMonth << 5) | tosDay;
        var tosSeconds = date.getSeconds() / 2;
        var tosMinutes = date.getMinutes();
        var tosHours = date.getHours();
        var tosTime = (tosHours << 11) | (tosMinutes<<5) | tosSeconds;
        return ((tosTime<<16) | tosDate) >>> 0;
     }

    function openLogTab(evt, tabName) {
        var i, tabcontent, tablinks;

        tabcontent = document.getElementsByClassName("tabcontent");
        tablinks = document.getElementsByClassName("tablinks");
        buttoncontent = document.getElementsByClassName("button");
        
        // Get all elements with class="tabcontent" and hide them
        for (i = 0; i < tabcontent.length; ++i) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        for (i = 0; i < tablinks.length; ++i) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

       for (i = 0; i < buttoncontent.length; ++i) {
            buttoncontent[i].style.visibility = 'hidden';
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(tabName).style.display = "block";
        document.getElementById("Clear" + tabName + "Button").style.visibility = 'visible';       
        evt.currentTarget.className += " active";
    } 

    </script>
    <style type="text/css">
        html, body
        {
            height: 100%;
            width: 100%;
            margin: 0px;
            padding: 0px;
            overflow: hidden;
          clear:both;
        }
       

    <!-- log tab style -->
    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Style the buttons that are used to open the tab content */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
     } 
    </style>
</head>
<body>

<header>
<font size="6">uIPTool</font> ver. VERSION    
</header>
<!-- Navigation interface -->
<nav>
<div id="DriveButtonListTab"> <div/>
<div id="CurrentDirPath" style="clear:both;float:bottom;">
<b>Current path:</b> <input type="text" id="navigationBar"/>
</div>
</nav>

<div id="mainSection" ondrop="event.preventDefault()" ondragover="event.preventDefault()" ondragenter="event.preventDefault()">
  <div id="directoryListView"></div>
  <div id="directoryView">
    <div id="fileView"></div>
    <div id="fileActionsView"></div>
  </div>
 </div>

 <!-- Tab links -->
 <div class="tab">
  <button class="tablinks" onclick="openLogTab(event, 'UploadQueTab')">Upload Que</button>
  <button class="tablinks" onclick="openLogTab(event, 'TransfersOkTab')">Successfull transfers</button>
  <button class="tablinks" onclick="openLogTab(event, 'TransfersFailedTab')">Failed transfers</button>
</div>

<!-- Tab content -->
<div id="UploadQueTab" class="tabcontent">
<div id=UploadGrid>
 <div>
    <button class="button" id="ClearUploadQueTabButton">Clear</button>
 </div> 
 <table style="width:100%">
  <tr>
    <th>Source path</th>
    <th>Destination path</th>
    <th>Size</th>
    <th>Progress</th>
  </tr>
  <tr>
    <td>K:\Repos\uiptools\uiptool\DUMMY.PRG</td>
    <td>C:\AUTO\DUMMY.PRG</td>
    <td>222323 bytes</td>
    <td>Upload</td>
  </tr>
  <tr>
    <td>K:\Repos\uiptools\uiptool\PIC.PNG</td>
    <td>C:\FOLDER\FOLDER\PIC.PNG</td>
    <td>3434 bytes</td>
    <td>Upload</td>
  </tr>
</table> 
</div>
</div>

<div id="TransfersOkTab" class="tabcontent">
    <div id=TransferOkGrid>
    <div> 
        <button class="button" id="ClearTransferOkButton">Clear</button> 
    </div>
    <table style="width:100%">
    <tr>
        <th>Source path</th>
        <th>Destination path</th>
        <th>Size</th>
        <th>Status</th>
    </tr>
    <tr>
        <td>K:\Repos\uiptools\uiptool\DUMMY.PRG</td>
        <td>C:\AUTO\DUMMY.PRG</td>
        <td>222323 bytes</td>
        <td>Upload</td>
    </tr>
    <tr>
        <td>K:\Repos\uiptools\uiptool\PIC.PNG</td>
        <td>C:\FOLDER\FOLDER\PIC.PNG</td>
        <td>3434 bytes</td>
        <td>Upload</td>
    </tr>
    </table> 
    </div>
</div>

<div id="TransfersFailedTab" class="tabcontent">
    <div id=TransferFailedGrid>
        <div>
            <button class="button" id="ClearTransfersFailedTabButton">Clear</button>
        </div>
        <table style="width:100%">
        <tr>
            <th>Source path</th>
            <th>Destination path</th>
            <th>Size</th>
            <th>Status</th>
        </tr>
        <tr>
            <td>K:\Repos\uiptools\uiptool\DUMMY.PRG</td>
            <td>C:\AUTO\DUMMY.PRG</td>
            <td>222323 bytes</td>
            <td>Failed</td>
        </tr>
        <tr>
        <td>K:\Repos\uiptools\uiptool\PIC.PNG</td>
            <td>C:\FOLDER\FOLDER\PIC.PNG</td>
            <td>3434 bytes</td>
            <td>Failed</td>
        </tr>
        </table> 
    </div>
</div> 
<footer>
Mystic Bytes &copy;2019
</footer>

<script>
(function() {
            // test display

            initSampleData();
            updateDriveViewUI(driveDummyData);
            updateDirectoryViewUI(directoryDummyData);
            updateFileViewUI(fileDummyData);        
        
            // your page initialization code here
            // the DOM will be available here

            //updateDriveListReq();
})();
</script>

</body>
</html>
a